USE [master]
GO

ALTER DATABASE Dumps SET SINGLE_USER WITH ROLLBACK IMMEDIATE;

ALTER DATABASE [Dumps] ADD FILEGROUP [Dumps_07_2019]
GO
ALTER DATABASE [Dumps] ADD FILE ( NAME = N'Dumps_07_2019_Unit1', FILENAME = N'E:\zebra\sqlserver\data\Dumps_07_2019_Unit1.ndf' , SIZE = 1048576KB , FILEGROWTH = 1048576KB ) TO FILEGROUP [Dumps_07_2019]
GO
ALTER DATABASE [Dumps] ADD FILE ( NAME = N'Dumps_07_2019_Unit2', FILENAME = N'G:\zebra\sqlserver\data\Dumps_07_2019_Unit2.ndf' , SIZE = 1048576KB , FILEGROWTH = 1048576KB ) TO FILEGROUP [Dumps_07_2019]
GO
ALTER DATABASE [Dumps] ADD FILEGROUP [Dumps_08_2019]
GO
ALTER DATABASE [Dumps] ADD FILE ( NAME = N'Dumps_08_2019_Unit1', FILENAME = N'E:\zebra\sqlserver\data\Dumps_08_2019_Unit1.ndf' , SIZE = 1048576KB , FILEGROWTH = 1048576KB ) TO FILEGROUP [Dumps_08_2019]
GO
ALTER DATABASE [Dumps] ADD FILE ( NAME = N'Dumps_08_2019_Unit2', FILENAME = N'G:\zebra\sqlserver\data\Dumps_08_2019_Unit2.ndf' , SIZE = 1048576KB , FILEGROWTH = 1048576KB ) TO FILEGROUP [Dumps_08_2019]
GO
ALTER DATABASE [Dumps] ADD FILEGROUP [Dumps_09_2019]
GO
ALTER DATABASE [Dumps] ADD FILE ( NAME = N'Dumps_09_2019_Unit1', FILENAME = N'E:\zebra\sqlserver\data\Dumps_09_2019_Unit1.ndf' , SIZE = 1048576KB , FILEGROWTH = 1048576KB ) TO FILEGROUP [Dumps_09_2019]
GO
ALTER DATABASE [Dumps] ADD FILE ( NAME = N'Dumps_09_2019_Unit2', FILENAME = N'G:\zebra\sqlserver\data\Dumps_09_2019_Unit2.ndf' , SIZE = 1048576KB , FILEGROWTH = 1048576KB ) TO FILEGROUP [Dumps_09_2019]
GO
ALTER DATABASE [Dumps] ADD FILEGROUP [Dumps_10_2019]
GO
ALTER DATABASE [Dumps] ADD FILE ( NAME = N'Dumps_10_2019_Unit1', FILENAME = N'E:\zebra\sqlserver\data\Dumps_10_2019_Unit1.ndf' , SIZE = 1048576KB , FILEGROWTH = 1048576KB ) TO FILEGROUP [Dumps_10_2019]
GO
ALTER DATABASE [Dumps] ADD FILE ( NAME = N'Dumps_10_2019_Unit2', FILENAME = N'G:\zebra\sqlserver\data\Dumps_10_2019_Unit2.ndf' , SIZE = 1048576KB , FILEGROWTH = 1048576KB ) TO FILEGROUP [Dumps_10_2019]
GO

ALTER DATABASE [Dumps] ADD FILEGROUP [Dumps_11_2019]
GO
ALTER DATABASE [Dumps] ADD FILE ( NAME = N'Dumps_11_2019_Unit1', FILENAME = N'E:\zebra\sqlserver\data\Dumps_11_2019_Unit1.ndf' , SIZE = 1048576KB , FILEGROWTH = 1048576KB ) TO FILEGROUP [Dumps_11_2019]
GO
ALTER DATABASE [Dumps] ADD FILE ( NAME = N'Dumps_11_2019_Unit2', FILENAME = N'G:\zebra\sqlserver\data\Dumps_11_2019_Unit2.ndf' , SIZE = 1048576KB , FILEGROWTH = 1048576KB ) TO FILEGROUP [Dumps_11_2019]
GO

ALTER DATABASE [Dumps] ADD FILEGROUP [Dumps_12_2019]
GO
ALTER DATABASE [Dumps] ADD FILE ( NAME = N'Dumps_12_2019_Unit1', FILENAME = N'E:\zebra\sqlserver\data\Dumps_12_2019_Unit1.ndf' , SIZE = 1048576KB , FILEGROWTH = 1048576KB ) TO FILEGROUP [Dumps_12_2019]
GO
ALTER DATABASE [Dumps] ADD FILE ( NAME = N'Dumps_12_2019_Unit2', FILENAME = N'G:\zebra\sqlserver\data\Dumps_12_2019_Unit2.ndf' , SIZE = 1048576KB , FILEGROWTH = 1048576KB ) TO FILEGROUP [Dumps_12_2019]
GO


ALTER PARTITION SCHEME [ps_Monthly]  
NEXT USED [Dumps_07_2019];

ALTER PARTITION FUNCTION [pf_Monthly]()  SPLIT RANGE (N'2019-07-31T00:00:00.000');


ALTER PARTITION SCHEME [ps_Monthly]  
NEXT USED [Dumps_08_2019];

ALTER PARTITION FUNCTION [pf_Monthly]()  SPLIT RANGE (N'2019-08-31T00:00:00.000');

ALTER PARTITION SCHEME [ps_Monthly]  
NEXT USED [Dumps_09_2019];

ALTER PARTITION FUNCTION [pf_Monthly]()  SPLIT RANGE (N'2019-09-30T00:00:00.000');

ALTER PARTITION SCHEME [ps_Monthly]  
NEXT USED [Dumps_10_2019];

ALTER PARTITION FUNCTION [pf_Monthly]()  SPLIT RANGE (N'2019-10-31T00:00:00.000');

ALTER PARTITION SCHEME [ps_Monthly]  
NEXT USED [Dumps_11_2019];

ALTER PARTITION FUNCTION [pf_Monthly]()  SPLIT RANGE (N'2019-11-30T00:00:00.000');

ALTER PARTITION SCHEME [ps_Monthly]  
NEXT USED [Dumps_12_2019];

ALTER PARTITION FUNCTION [pf_Monthly]()  SPLIT RANGE (N'2019-12-31T00:00:00.000');

GO 
RUNDAILY: 
DECLARE @DATE DATE = '2019-07-01' 
DECLARE @DATE_TEXT VARCHAR(8) = ''


DECLARE @SQL nVARCHAR(MAX) = '' 

WHILE @DATE  <= '2019-12-31'

BEGIN 
SET @DATE_TEXT  = CONVERT(VARCHAR(8) , @DATE,112)
SET @SQL = 
'ALTER DATABASE Dumps
ADD FILEGROUP fg_UDC_##;

ALTER DATABASE Dumps   
ADD FILE   
(  
    NAME = ''f_UDC_##_Unit1'',  
    FILENAME = ''I:\zebra\sqlserver\data\udc\f_UDC_##_Unit1.ndf'',  
    SIZE = 100MB,  
    MAXSIZE = UNLIMITED,  
    FILEGROWTH = 10%
),  
(  
    NAME = ''f_UDC_##_Unit2'',  
    FILENAME = ''Y:\zebra\sqlserver\data\udc\f_UDC_##_Unit2.ndf'',  
    SIZE = 100MB,  
    MAXSIZE = UNLIMITED,  
    FILEGROWTH = 10%
)  
TO FILEGROUP fg_UDC_##;'

SET   @SQL = REPLACE(@SQL,'##',@DATE_TEXT)

EXEC(@SQL)
SET @DATE  = DATEADD(DAY,+1, @DATE)
END 


USE [Dumps]


DECLARE @DATE2 DATE = '2019-07-04' 
DECLARE @DATE_Inner VARCHAR(30) = 'N''##T00:00:00.000'''
DECLARE @DATE_TEXT2 VARCHAR(MAX) = ''
DECLARE @SQL2 nVARCHAR(MAX) =
'
ALTER PARTITION FUNCTION [pf_Daily]()  SPLIT RANGE (###);'


DECLARE @DATE_Inner3 VARCHAR(30) = '[fg_UDC_##]'
DECLARE @DATE_TEXT3 VARCHAR(MAX) = ''
DECLARE @SQL3 nVARCHAR(MAX) =
'
ALTER PARTITION SCHEME [ps_Daily]  NEXT USED ###;'


WHILE @DATE2  <= '2019-12-31'

BEGIN 
SET @DATE_Inner =  'N''##T00:00:00.000'''
SET @DATE_Inner  = REPLACE(@DATE_Inner,'##',CAST(@DATE2 AS VARCHAR(10)))
--SET @DATE_TEXT2 =  LTRIM(RTRIM(@DATE_TEXT2)) + CASE WHEN @DATE2 = '2019-06-30' THEN  REPLACE(@DATE_Inner,',','') ELSE @DATE_Inner END

SET @DATE_TEXT2 =  @DATE_Inner 

SET @DATE_Inner3 = '[fg_UDC_##]'
SET @DATE_Inner3  = REPLACE(@DATE_Inner3,'##',CONVERT(VARCHAR(8),@DATE2,112))
--SET @DATE_TEXT3 =  LTRIM(RTRIM(@DATE_TEXT3)) + CASE WHEN @DATE2 = '2019-06-30' THEN  REPLACE(@DATE_Inner3,',',', [fg_ggsnStaging_Overflow]') ELSE @DATE_Inner3 END

SET @DATE_TEXT3 =  @DATE_Inner3 

SET @SQL3 = REPLACE(@SQL3,'###',@DATE_TEXT3)
SET @SQL2 = REPLACE(@SQL2,'###',@DATE_TEXT2)

PRINT @SQL3
PRINT @SQL2

EXEC(@SQL3)
EXEC(@SQL2)

SET @DATE2 = DATEADD(DAY,+1, @DATE2)
SET @SQL2  =
'
ALTER PARTITION FUNCTION [pf_Daily]()  SPLIT RANGE (###);'
SET @SQL3  =
'
ALTER PARTITION SCHEME [ps_Daily]  NEXT USED ###;'
END 




ALTER DATABASE Dumps SET MULTI_USER ;
